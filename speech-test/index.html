<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-KQMLYS3VVE"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag("js",new Date());gtag("config","G-KQMLYS3VVE");</script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#08090a">
    <title>Speech Test ‚Äî How Well Does AI Understand You?</title>

    <!-- Inter Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                }
            }
        }
    </script>

    <style>
        body {
            background: #08090a;
            color: #f7f8f8;
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
        }
        @keyframes pulse-recording {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        .recording-pulse {
            animation: pulse-recording 1.5s infinite;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- ===== NAVIGATION ===== -->
    <header class="fixed top-0 left-0 right-0 z-50 bg-[#08090a]/80 backdrop-blur-xl border-b border-white/[0.04]">
        <nav class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between h-14 lg:h-[72px]">
            <a href="/" class="text-[#8a8f98] hover:text-[#f7f8f8] text-[14px] font-medium transition-colors inline-flex items-center gap-1.5">
                ‚Üê DayOneBuilder
            </a>
            <a href="https://x.com/DayOneBuilder" target="_blank" rel="noopener noreferrer"
               class="text-[#8a8f98] hover:text-[#f7f8f8] transition-colors inline-flex items-center">
                <svg class="w-[18px] h-[18px]" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                </svg>
            </a>
        </nav>
    </header>

    <!-- ===== MAIN CONTENT ===== -->
    <main class="flex-1 pt-24 lg:pt-32 pb-16 px-4 sm:px-6">
        <div class="max-w-xl mx-auto">
            <div class="mb-8">
                <h1 class="text-[2rem] sm:text-[2.5rem] font-semibold tracking-[-0.03em] leading-[1.1] text-[#f7f8f8] mb-3">
                    üé§ Speech Test
                </h1>
                <p class="text-[15px] text-[#8a8f98] leading-[1.6]">
                    Read the text aloud. AI will score how clearly you speak English.
                </p>
            </div>

            <!-- Reference Text Card -->
            <div class="rounded-xl bg-white/[0.02] border border-white/[0.06] p-5 mb-5">
                <h3 class="text-[13px] font-medium text-[#565960] uppercase tracking-wide mb-3">Read this text</h3>
                <div id="reference-text" class="text-[15px] lg:text-base text-[#b4b7be] leading-[1.8] p-4 rounded-lg bg-white/[0.02] border border-white/[0.04] mb-4"></div>
                <button id="record-btn" onclick="toggleRecording()"
                    class="w-full inline-flex items-center justify-center gap-2 font-medium rounded-xl transition-all h-12 px-6 text-[15px] bg-red-600 text-white hover:bg-red-500 active:scale-[0.98]">
                    üéô Hold to Record
                </button>
                <p class="text-[13px] text-[#565960] text-center mt-3" id="status"></p>
            </div>

            <!-- Result Card -->
            <div class="hidden" id="result">
                <div class="rounded-xl bg-white/[0.02] border border-white/[0.06] p-5 mb-4">
                    <div class="text-center py-4">
                        <div class="text-5xl font-bold" id="score-value"></div>
                        <p class="text-[13px] text-[#565960] mt-2">Clarity Score</p>
                    </div>
                    <h3 class="text-[13px] font-medium text-[#565960] uppercase tracking-wide mb-3">AI heard</h3>
                    <div id="recognized-text" class="text-[15px] text-[#b4b7be] leading-[1.7] p-4 rounded-lg bg-white/[0.02] border border-white/[0.04]"></div>
                </div>
                <button onclick="newText()"
                    class="w-full inline-flex items-center justify-center gap-2 font-medium rounded-xl transition-all h-12 px-6 text-[15px] bg-white/[0.04] text-[#8a8f98] hover:bg-white/[0.06] hover:text-[#f7f8f8] active:scale-[0.98] border border-white/[0.06]">
                    Try Another Text
                </button>
            </div>

            <!-- Info -->
            <p class="text-[13px] text-[#565960] text-center mt-8 leading-relaxed">
                Powered by Groq Whisper large-v3. Audio is sent to Groq API for recognition.<br>
                No data is stored.
                <a href="https://x.com/DayOneBuilder" target="_blank" class="text-[#8a8f98] hover:text-[#f7f8f8] transition-colors">@DayOneBuilder</a>
            </p>
        </div>
    </main>

    <!-- ===== FOOTER ===== -->
    <footer class="py-6 border-t border-white/[0.04]">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-center">
            <p class="text-[#5c5f66] text-[13px]">¬© 2026 DayOneBuilder</p>
        </div>
    </footer>

    <script>
        const texts = [
            "The quick brown fox jumps over the lazy dog near the riverbank on a warm summer afternoon.",
            "Technology is transforming how we communicate, work, and live our daily lives around the world.",
            "She sells seashells by the seashore, and the shells she sells are seashells for sure.",
            "The weather forecast predicts heavy rainfall throughout the weekend across the northern regions.",
            "A good developer writes code that humans can understand, not just code that machines can execute.",
            "Please call Stella and ask her to bring these things from the store: six spoons of fresh snow peas, five thick slabs of blue cheese, and maybe a snack for her brother Bob.",
            "International cooperation is essential for addressing global challenges such as climate change and public health.",
            "The restaurant on the corner serves excellent breakfast, especially their homemade pancakes with maple syrup.",
        ];

        let mediaRecorder = null;
        let audioChunks = [];
        let isRecording = false;

        const GROQ_API_KEY = '';

        function newText() {
            const el = document.getElementById('reference-text');
            el.textContent = texts[Math.floor(Math.random() * texts.length)];
            document.getElementById('result').classList.add('hidden');
            document.getElementById('status').textContent = '';
        }

        async function toggleRecording() {
            const btn = document.getElementById('record-btn');
            if (!isRecording) {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorder = new MediaRecorder(stream, { mimeType: 'audio/webm;codecs=opus' });
                    audioChunks = [];
                    mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
                    mediaRecorder.onstop = () => {
                        stream.getTracks().forEach(t => t.stop());
                        processAudio();
                    };
                    mediaRecorder.start();
                    isRecording = true;
                    btn.textContent = '‚èπ Stop Recording';
                    btn.classList.add('recording-pulse', 'bg-red-800');
                    btn.classList.remove('bg-red-600');
                    document.getElementById('status').textContent = 'Listening...';
                } catch (e) {
                    document.getElementById('status').textContent = '‚ùå Microphone access denied';
                }
            } else {
                mediaRecorder.stop();
                isRecording = false;
                btn.textContent = 'üéô Hold to Record';
                btn.classList.remove('recording-pulse', 'bg-red-800');
                btn.classList.add('bg-red-600');
                btn.disabled = true;
                btn.classList.add('opacity-50', 'cursor-not-allowed');
                document.getElementById('status').textContent = '‚è≥ Recognizing...';
            }
        }

        async function processAudio() {
            const blob = new Blob(audioChunks, { type: 'audio/webm' });
            const formData = new FormData();
            formData.append('file', blob, 'recording.webm');
            formData.append('model', 'whisper-large-v3');
            formData.append('language', 'en');
            formData.append('response_format', 'json');

            try {
                const resp = await fetch('https://api.groq.com/openai/v1/audio/transcriptions', {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${GROQ_API_KEY}` },
                    body: formData
                });
                const data = await resp.json();
                if (data.error) throw new Error(data.error.message);
                showResult(data.text || '');
            } catch (e) {
                document.getElementById('status').textContent = '‚ùå Recognition failed: ' + e.message;
                enableRecordBtn();
            }
        }

        function enableRecordBtn() {
            const btn = document.getElementById('record-btn');
            btn.disabled = false;
            btn.classList.remove('opacity-50', 'cursor-not-allowed');
        }

        function showResult(recognized) {
            const reference = document.getElementById('reference-text').textContent;
            const score = calculateScore(reference, recognized);

            document.getElementById('recognized-text').textContent = recognized;

            const scoreEl = document.getElementById('score-value');
            scoreEl.textContent = score + '%';
            scoreEl.className = 'text-5xl font-bold ' + (score >= 80 ? 'text-emerald-400' : score >= 50 ? 'text-amber-400' : 'text-red-400');

            document.getElementById('result').classList.remove('hidden');
            document.getElementById('status').textContent = '';
            enableRecordBtn();
        }

        function calculateScore(reference, recognized) {
            const refWords = reference.toLowerCase().replace(/[^\w\s]/g, '').split(/\s+/);
            const recWords = recognized.toLowerCase().replace(/[^\w\s]/g, '').split(/\s+/);

            let matches = 0;
            const recSet = new Set(recWords);
            for (const word of refWords) {
                if (recSet.has(word)) matches++;
            }
            return Math.min(100, Math.round((matches / refWords.length) * 100));
        }

        newText();
    </script>
</body>
</html>
